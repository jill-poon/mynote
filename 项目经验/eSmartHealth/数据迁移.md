# 健康数据表迁移

## 拆分原因

- 单表数据量超过 30,000,000 条，单表容量超过 10G
- SQL 查询时间超过 300ms
- 数据查询接口响应时间超过 500ms

## 分片规则

1. 查询逻辑

```sql
select 
    data_id,
    data_number_1,
    data_number_2,
    data_number_3,
    data_number_4,
    data_number_5
from `tbl_data` as `t` 
where `t`.`uid`=?
and `t`.`data_type`=?
and `t`.`mtime` between ? and ?;
```



### 按 `data_type` 字段垂直拆分

#### 存在问题

- 原有数据表为通用性，把所有类型的数据都保存到 `tbl_data` 单个表中，表中存在大量未被使用 `NULL` 字段，导致占用更多的表空间

#### 方案

- 按数据类型添加新的表

```sql

create table tbl_data_bloodpressure_0 ...;
create table tbl_data_bloodglucose_0 ...;
create table tbl_data_temperature_0 ...;
```