# 编程规约

## Mysql

### 推荐进行分库分表

**单表行数超过 500 万行** 或者 **单表容量超过 2GB**，才推荐进行分库分表。
说明：如果预计 **三年后的数据量** 根本达不到这个级别，请不要在创建表时就分库分表。

### 索引插入效率

**500 万行数据** 或者 **2GB数据** 以内，索引插入影响效率可以忽略不计

### varchar 字段上建立索引

在 varchar 字段上建立索引时，必须**指定索引长度**，没必要对全字段建立索引，根据**实际文本区分度**决定索引长度。
索引的**长度**与**区分度**是**一对矛盾体**，一般对字符串类型数据，长度为 **20** 的索引，区分度会高达 **90%**
以上，可以使用 `count(distinct left(列名,  索引长度))/count(*)` 的区分度来确定。

### 区分度小技巧

有些字段的特征在于，前面大多数部分都是相同的，只是后面几位不同，对于这样的字段我们保留前几位作为索引字段时不行的，那实际上可以通过 **倒序存储** 的方式来满足。

### 利用延迟关联或者子查询优化超多分页场景

MySQL 并不是**跳过 offset 行**，而是**取 offset+N 行**，然后**返回放弃前 offset 行，返回 N 行**，那当
offset 特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过特定阈值的页数进行 SQL改写。

正例1：先快速定位需要获取的 id 段，然后再关联：

```sql
SELECT a.* FROM  表1 a, (select id from 表1 where 条件  LIMIT 100000, 20) b where a.id=b.id
```

正例2：限制前端分页条件
