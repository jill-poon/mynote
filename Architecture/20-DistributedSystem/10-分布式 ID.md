# 分布式 ID

## 要求

1. 全局唯一
2. 高性能
3. 高可用
4. 趋势自增 (B+Tree 索引，页分裂)

## 1 UUID

- **优点：**
    - 无网络开销，快
- 缺点：
    - 非趋势自增
    - MySQL 字符串主键消耗空间

## 2 外部存储

1. 数据库
    1. 单机
    2. 集群
    3. 段号
2. Redis

## 3 Snowflake

### 3.1 上百集群 WorkerId 设置问题

1. Redis 生成 WorkerID
2. Zookeeper 生成 WorkerID
3. UidGenerator (百度) 使用 MySQL 自增主键
4. Leaf (美团) Zookeeper 序列节点 `${ip}:${port}`

### 3.1 时钟回拨问题

1. **UidGenerator** 采用 `AtomicLong` 作为时间戳，通过递增方式避免时钟回拨问题