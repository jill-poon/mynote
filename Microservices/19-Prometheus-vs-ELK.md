# Prometheus vs ELK

## Prometheus

Prometheus 是一个开源的**监视和警报系统**，它从应用程序服务、服务器和其他目标源提取指标。

### Prometheus 的优点

1. 提供给 Kubernetes 极其强大的**服务发现功能**，查找所有服务，并从 Prometheus 端点提取指标。
2. 即使基础设施的其他部分都坏了，Prometheus 也能正常工作。不需要安装 agent，Prometheus 已经可以提取指标了。
3. **不需要多而繁杂的设置**。
4. **允许快速宕机发现**。当系统无法从已知的监视源获得请求时，可以很快发现服务中断。
5. 提供了一个函数式查询语言 **`PromQL`**，它允许我们实时选择和聚合时间序列数据。它可以应用子查询、函数和操作符。它可以根据标签进行过滤和分组，并使用正则表达式来改进匹配和过滤。
6. 确保**简单的重新配置**。配置可以通过命令行更改。例如，不可变的系统参数，如存储位置或要保存在磁盘和内存中的数据量，以及配置文件，如作业、实例或要加载的规则文件。修改配置会自动申请所有监控服务。
7. Prometheus 对被监视的服务和网络的**负载很低**，因为指标在生成、转换为可读格式时存储在内存中，并且无论生成多少事件，Prometheus 都按请求接收它们(默认每15秒一次)。
8. Prometheus 架构设计系统提供了操作的**简单**性。受限于单节点，Prometheus 避免了集群，因为集群会带来操作的复杂性。

### Prometheus 的缺点

1. **监控限制** (增加服务器存储容量或限制指标数量所需)。
2. **不提供可靠的长期数据存储、异常检测、水平伸缩和用户管理**。基本上，这些需求对于大型企业环境是至关重要的。
3. Prometheus **不是一个仪表盘**解决方案。Prometheus Expression Browser 提供了简单的可视化，但是在使用 Prometheus 进行监视时，需要使用 Grafana 作为仪表板来提供可视化监控。

## ELK

* ELK 栈是三种开源工具的组合，形成了一个日志管理平台，专门搜索、分析和可视化来自不同系统的日志。

### Logstash

1. 提供带有管理用户界面 (UI) 的数据管道工具，允许用户使用单个 UI 控制部署。
2. 集中处理数据。
3. 收集和分析大量的结构化和非结构化数据和事件。
4. 提供插件连接到各种类型的输入源和平台。
5. 从 IP 地址破译地理坐标。
6. 可以接收来自一个或多个源的日志和事件，然后处理并将它们转换为一个或多个存储。

### Elasticsearch

> Elasticsearch 是 ELK 栈的核心。它是一个提供**分布式数据存储的 NoSQL 数据库**。它通过提供不同的查询类型 (如结构化、非结构化和度量数据) 来提供详细的分析

1. 提供搜索引擎/搜索服务器的可能性。
2. 提供全文搜索。
3. 使用标准的 RESTful API 和 JSON ，因为它是基于 Apache Lucene 的。
4. 提供无模式、REST 和 JSON 分布式数据存储。
5. 提供水平可伸缩性、可靠性和实时搜索功能。
6. 使用索引进行搜索，提高搜索速度。
7. 提供安全、监控、报警、异常检测、异常预测、图形探测、报表等功能。

### Kibana

1. Kibana 是一个可视化工具，与 Elasticsearch 和 Logstash 配套使用。
2. Kibana 是用于 Elasticsearch 日志的**最佳可视化工具**，但数据也可以从 Elasticsearch 导出到 Grafana，以实现更高级的指标可视化。
3. Kibana **已经完全设置好**了所有你需要处理 Elasticsearch 可视化的东西。

### ELK 的优点

1. 通过一个ELK实例提供对分布式系统深入的了解，而不需要连接到数百个日志数据源。
2. 基于 Java 开发的 Elasticsearch 几乎可以兼容所有平台。
3. Elasticsearch 是**实时**的。这意味着只需几秒钟就可以浏览添加的文档。
4. Elasticsearch 支持多种语言的客户端，如 Java、Python、.net、SQL 和 PHP。
5. 为不同的编程和脚本语言提供了一堆sdk。
6. 能够**垂直和水平缩放**。

### ELK 的缺点

1. **不能快速安装使用**。有时，公司需要快速解决其问题，但安装、设置和调优ELK系统可能需要大量时间。
2. **需要花费大量的时间来提供可靠性**。由于 Logstash 和 Elasticsearch 是内存密集型的，需要做很多工作来防止 Elastic 节点宕机。公司需要一个专家团队来保证可靠性和弹性。

## Prometheus、ELK 对比

Prometheus 和 ELK 这两种监控系统，都有类似的目的。他们的**目标是检测问题、调试和解决问题**。但是这些系统使用不同的方法来完成这项任务。

最大的区别是 **ELK 专门处理日志**，而 **Prometheus 专门处理度量**。

### 共同点

#### 1 开源软件

Prometheus和ELK都是**开源软件**。这两个项目都有大量活跃的开发人员和用户社区。

#### 2 云服务

这两种监控系统都可以作为**云服务**使用，也可以在现场操作。

#### 3 访问方法

这两个系统都使用 RESTful HTTP / JSON API **访问方法**。

#### 4 支持客户端语言

系统支持相同范围的**编程语言**:. net、Java、Python、Ruby。

#### 5 数据分片

这两个系统都使用**分片**方法在不同的节点上存储不同的数据。

#### 6 提醒选项

这两个系统都支持不同的**提醒选项**，集成了电子邮件、Slack 或 PageDuty。

#### 7 冗余存储数据

Prometheus 和 ELK 采用复制的方式在多个节点上冗余存储数据。

#### 8 系统集成

ELK，以及普罗米修斯，可以与许多不同的系统集成。有大量的工具用于与不同的数据库、存储、api、其他监控系统和硬件相关的集成进行集成。

### Prometheus、ELK 不同点

#### 1 使用范围

* Prometheus 用于量度收集、各种系统监视和基于这些量度设置警报
* ELK 用于获取所有类型的数据，基于这些数据执行不同类型的分析、搜索和可视化

#### 2 数据库模型

* Prometheus 使用 **TimeSeries DBMS** 作为它的主要数据库模型
* ELK 栈的主要数据库模型是一个**搜索引擎**，它支持使用**反向索引**存储不同的**非结构化数据类型**，允许非常快速的**全文搜索**

#### 3 不同类型的查询

* Prometheus 使用自己的 **`PromQL`**，它实际上非常简单且功能强大
* ELK 提供了基于 JSON 的特定于领域的查询语言。Elasticsearch 还提供了使用类似 sql 的查询的特性

#### 4 存储方式

* ELK 使用无模式的数据模式
* Prometheus 存储由指标名称和键/值对标识的数据

#### 5 存储方式

* ELK 从不同的来源收集各种日志，分析并存储它们
* Prometheus 通过在 **`HTTP`** 上的 **`pull`** 方法以标准格式收集指标

#### 6 数据类型

* 在 ELK 栈中，可以存储不同类型的数据，如数字、字符串、布尔值、二进制值等等。这可以让你以更有效的方式保存、分析和使用数据，而不管数据是什么
* Prometheus 存储命名时间序列的数字示例

#### 7 数据存储时间

* 与 Prometheus 相比，**ELK 提供了更长期的数据保留**
* Prometheus 在实例中本地存储数据，默认为15天
  * 默认的15天可以配置为任意值，最小值为2小时
  * 在较长时间内，本地 Prometheus 实例中的长期存储变得很困难
  * 在一个节点上存储和计算数据使操作更容易，但也使扩展和确保高可用性变得更难
  * Prometheus 并没有优化为一个长期的度量存储

#### 8 增值服务

* 额外付费的 ELK 包，也就是所谓的 X-Pack，提供了更多的服务
  * Kibana 和 Elasticsearch 的身份验证和授权，Elasticsearch 是一个增强功能的警报系统
  * 机器学习部分提供异常检测和预测

#### 9 可视化

* Kibana 允许分析数据中的关系(例如显示相关产品)，并可视化这些关系
* Prometheus 在它的列表中没有这样的扩展特性，所有的分析都必须通过 Grafana 进行

#### 10 反向索引

* Elasticsearch 使用一种叫做反向索引的结构，允许非常快速的全文搜索

#### 11 安全特性

* Elasticsearch Stack 的安全特性非常广泛。系统为正确的人提供了正确的访问权限。一些特性包括加密通信(使用 SSL/TLS 证书进行流量加密)、基于角色和基于属性的访问控制、字段和文档级安全、ip 过滤、审计日志记录等。

## Prometheus vs ELK 使用场景

### 使用 ELK 的场景示例

1. 正在进行事件日志记录。  
2. 需要处理大量的日志数据。
3. 需要长期的数据存储。
4. 需要对一个特定的事件有深刻的见解。
5. 需要一个集群解决方案。

### 使用 prometheus 的场景示例

1. 主要是做度量指标。
2. 需要简单地设置监视和绘图工具。
3. 需要跨各种来源进行告警。

## 结论  

虽然 Prometheus 和 Elasticsearch 是用于监视基础设施和警报的非常相似的工具，但这些系统通常用于不同的任务。**最大的区别是 ELK 专门处理日志**，**而 Prometheus 专门处理度量指标**。大多数主要产品都需要同时使用 ELK 和 Prometheus，每个产品都有自己的专长。
