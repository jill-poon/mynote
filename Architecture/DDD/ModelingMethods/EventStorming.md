# 事件风暴 (Event Storming)

[TOC]

## 什么是事件风暴

[事件风暴](https://www.eventstorming.com/) 一种 **灵活** 的 **研讨会** 形式，用于 **协作探索复杂** 的 **业务领域**。

* 可用于不同的场景
  * 评估现有业务线的健康状况，并发现最有效的改进领域
  * **探索**新的初创商业模式的可行性
  * 设想新的服务，最大限度地为所有相关方带来积极成果
  * 设计干净且可维护的 **事件驱动** 软件，以支持 **快速** 发展的业务

## 目的

**统一语言**的素材，包含对商业流程的**共同理解**，包含:

* 名词使用
* 责任范围
* 使用者体验

## 优点

1. 快速
   * 事件风暴方法减少了创建全面的业务域模型所需的时间。过去需要数周的时间，一次研讨会可以在几个小时内完成。
2. 简单明确
    * 事件风暴不使用复杂的UML，而是将过程分解为技术和非技术利益相关者都可以理解的简单术语。不需要有过多准备，直接识别利益相关者就可以开始。
3. 参与
   * 事件风暴的目标之一是使建模变得有趣。这是一种动手的领域建模方法，可邀请每个人参与和交互。除了使参与者更加愉快之外，事件参与者还可以使参与者获得更多有价值的见解，因为参与者可以更轻松地参与该过程并提供他们的建议和专业知识。
4. 有效
   * 事件风暴不是数据建模，但通过大家讨论可以快速实施和验证的行为模型。同时为了获得最佳结果，团队应将事件风暴与面向领域驱动设计的实施相结合。

## 事件风暴应用场景

### Big Picture (概览图)

* 厘清混沌商业系统，凸显出合作关系、边界、责任归属与不同利益相关者的观点。邀请任何有兴趣的人、不用限制讨论范围。
* 找出**瓶颈**、**核心价值**甚至是新的**解决方案**
* 主要以 **Event** 、 **System** 、**Question** 为主。
* 适合新创或小团队(人少、技术债少)

### Process Modelling (流程模型)

* 讨论特定功能流程，以确保大家理解没有明显分歧，最后达到理解的一致性。
* 有明确范围，所以路径越完整越好。
* 在细节中找出流程的Bug，并且每个Bug都需要被处理。
* 包含Event、Actor、Command、 System、Policy、 Read Modelo

### Software Design (软件开发)

* 利用前面的产出进一步设计软件
* 加入 `Aggregate` (聚合)、 `BoundedContext` (限界上下文) 建立**模型边界**。

## 事件风暴准备

### 场地设置

* 找到一面**限制最少的表面来进行活动**。不管是墙面、窗边甚至用多面移动白板组成都可以。你无法预测最后的产出有多少，所以尽你所能，不要因为空间而限制活动的品质。
* 在表面上贴上**大型画纸卷**方便收纳产出以及进行另一场 Event Storming
* **最大化活动空间**。将现场的杂物移开，不过可以留下一张小桌子放道具。
* **一定要将椅子移走**。经验中，只要有人坐下，就会开始沉默，最后自我放逐。。(建议)一面白板或海报写上名词定义清单。这场会议中的对话都要遵照清单上的用词。
* 提供几张**有图示标明 (Legend) 的海报纸**。

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/8115e6f9eb944a91b0911aa909bf6cb3.png)![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/488dfa83e4274508aff6b09a49c1a075.png)

### 海报纸

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/9d1e5a89d5694a0ca0723055876ce024.png)

### 邀请正确的人来参与

传统的建模过程通常需要一名或几名研发人员来一起进行类设计、接口设计，通讯协议和数据映射等。而事件风暴则可能是较大的不同团队的成员来一起构建领域模型。

#### 谁是合适的人？

根据Brandolini的说法，他们是知道提出正确问题和拥有答案的人。该小组可能是**代表用户体验**，**业务**，**架构**，**开发**，**运维**和**营销**等**利益相关者的混合体**。

**主持人 / Facilitator:**

建议一定要有一名参与者负责**主持会议进行**、**推动议程讨论**。要**严格注意时间与流程**。最好**不要**跟 Domain Expert 重复。

**领域专家(们) Domain Expert(s):**

专案的主要推动者，或是拥有足够领域知识的人，建议最好**有一定的决定权**，在陷入泥沼时才可以做出决定。如果是新创领域，可以事先做好使用者访谈或是找使用者来参加。可以不只一名。

**其他利益相关者Other Stackholder:**

可能是参与专案的**工程师**、**设计师**，也可能任何能提供专业意见的人士如**业务**、**商业分析师**甚至是**主管**。

### 事件分类颜色

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/c8a261c008574715a2b3e5ce4af32c3e.png)

* 橘色 (正方形 76*76)：Event 事件
* 蓝色 (正方形)：Command 命令
* 紫色 (长方形)： Policy/Process 商业政策/流程
* 黄色 (小张长方形)：Actor 角色
* 黄色 (长方形)：Aggregate 聚合
* 粉红色 (长方形)：System 外部系统
* 红色 (正方形)：Hotspot 热点
* 红色 (小张长方形)：Problem 疑问
* 绿色 (小张长方形)：Opportunity 机会
* 绿色 (正方形)：Read Model 资料读取模型
* 白色 (大张正方形)：Uset Interface 使用者介面

### 实施步骤

#### 从事件开始 (Event)

主持人会先请领域专家**简介专案需求**，然后由领域专家(或是主持人)在画面正中央**贴上第一张Event**。贴在中间**一方面可以灵活拓展**，**另一方面也能让所有人一起参与**。

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/e6e908ad32994d6b91c6719f8c3743a5.png)

##### 橘色便签条

1. 使用过去式
    * 根据Alberto Brandolini本人的叙述，**使用过去式代表着系统的状态**，如订单已成立、货物已送出、早餐已买到等等
2. **领域专家所在乎的事件**
    * 如整合第三方物流时，领域专家可能只在乎送达时间而不在乎中间细节的运输过程。
3. **有时间性**，请从左到右排列。同时加上时间概念。
    * 如凌晨三点帐款已对帐完成、午夜十二点马车已变成南瓜、本季度已结束、已过了一个月
4. 可以**加上原因**
    * 如因为密码输入错误三次，所以帐号已被锁住、比如商城的订单模块，用户下单事件
5. 以**状态**作为**主流程**
    * 待支付、待审核、待发货

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/100492e002ae4294bed74ada67694659.png)

#### 提出问题 (Hotspot)

比如(主持人此时重要功能是将大家讨论全部针对事情上来)主持人**鼓励随时打断**、**不要放过任何模棱两可**，比如:

* 我不懂
* 商业逻辑和自己理解不同
* 与现有的处理逻辑不同
* 用户体验差

##### 红色便签条

* 热点问题
* 如果过程中某个节点卡住太久，很有可能是因为领域专家也不太了解这个问题，也有可能是目前资料量不足以做出决定。先贴上一张45度角旋转后的**红色**的Hotspot待日后解决。

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/fc2e7ef9d513422ebe17d5b412e66d87.png)

#### 命令 (Command)

`Command` 的主体可以是**用户 (Actor)**、**后台管理**也可以是**系统触发**。

##### 蓝色便签条

* 事件的**触发器**
* *事件是对过去已发生的陈述*，命令**表达了对将来发生某些事情的意图**。
* 命令**可以是执行**也**可以是拒绝执行**
  * 例如，如果在订单系统中，库存不足，触发拒绝订单事件

#### 资料读取模型 (Read Model)

##### 绿色便签条

一些读取的信息

#### 外部系统 (System)

##### 粉红色便签条

* 一般由 **`Command`** 或者由**第三方回调** (支付完成) 所触发。`System` 在上一流程完成后，**再产生新的Event**。
  * 比如用户支付完成，系统生成「卖家发货」、「物接揽收」、「开始分拣」、「运输中」、「商品已到指定取货点」等。

#### 商业政策/流程 (Policy/Process)

##### 紫色 (长方形) 便签条

* **系统对于特定Event如何回应**
* `Policy` 就像 Event Storming 的侦探一样，可以**找出许多尚未发掘的问题**或是**现有流程矛盾**之处。

#### 围绕聚合对事件和命令进行分组 (Aggregate)

##### 黄色 (长方形) 便签条

* 每个 `Aggregate` 代表一个**特定的业务概念**，该概念具**有具体的业务功能**。
* 同时在时间表上标记了这些组。刚标好的组，标记聚合可能把时间顺序打乱。

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/a390d097ede44ed68cd0ccf2849aaab2.png)

`Aggregate` 想成是一个 **State Machine (有限状态机)**，一个 Model 会有很多的状态，因此**一种 Aggregate 可能会对应到多组 Command 与 Event**。

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/9aee88d6477f4b2fb3fca33d0629282b.png)

## 电商项目设计流程

DDD 可以将 **业务分析** 与 **技术进行** 分离。

我们在进行领域驱动设计时，需要考虑**战略设计**以及**战术设计**。包括**架构选型**。

* 战略设计通过 **限界上下文** 从 **全局** 的角度 **规划** 整个系统的 **业务模块**
* **逐步细化**，对**每个模块**开展事件风暴会议**进行领域建模**
* 逐步落实到每个模块的**数据库设计**与**微服务设计**以及需要涉及的**分布式技术**与**云端部署**

我们就以我们的一体化商城平台项目为例，我们的一体化商城项目是一套集物流，仓储，电商为一体的智慧电商平台。同时，服务于广大的中小型商家。商家可以在平台进行申请开店。平台提供对应的第三方物流，仓储以及一系列交易保证功能。

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/f4181139cfb84c5e9009f07d94796fc3.png)

一体化商城系统

* 移动用户端 + PC端电商网站 技术专家 +  技术经理
* PC端商家后台 + 移动端商家后台 技术专家 +  技术经理
* PC端后台管理 技术专家 +  技术经理
* 大数据管理后台 技术专家 +  技术经理

支撑子域

得到多个聚合 APP下单

用例模型 领域模型 建模  

架构技术填充

![image.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/1463/1634646828000/ae2736eeb9b14316bd162ab1d9a36925.png)
